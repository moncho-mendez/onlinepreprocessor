<!DOCTYPE html>
<html>
    <head> 
        <title th:text="#{app.name}"></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="initial-scale=1, width=device-width">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.3.1/flatly/bootstrap.min.css" rel="stylesheet" integrity="sha384-T5jhQKMh96HMkXwqVMSjF3CmLcL1nT9//tCqu9By5XSdj7CwR0r+F3LTzUdfkkQf" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/css/style.css">  
    </head>
    <body class="main-bg">
        <div class="header">
            <div th:include="header.html"></div>
        </div>
        <div class="container">
            <div id="banner" class="page-header">
                <div class="row">
                    <div class="col-12">
                        <h2 th:text="#{create.dataset.title}"></h2> 
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <h4 class="create" th:text="#{create.dataset.filters}"></h4> 
                </div>
            </div>
            <form action="#" th:action="@{/dataset/create}" th:object="${dataset}" enctype="multipart/form-data" method="POST">
                <!-- FILTERS -->
                <div class="row">
                    <div class="col-3">
                        <div class="form-group">
                            <label for="license" th:text="#{create.dataset.licenses}"></label>
                            <select multiple="" class="form-control" id="license">
                                <option value="" th:text="#{create.dataset.nooptionselected}">
                                <option th:each="license : ${licenses}" th:attr="value = ${license.name}" th:text="${license.name}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-group">
                            <label for="datatype" th:text="#{create.dataset.datatypes}"></label>
                            <select multiple="" class="form-control" id="datatype">
                                <option value="" th:text="#{create.dataset.nooptionselected}">
                                <option th:each="datatype : ${datatypes}" th:attr="value = ${datatype.datatype}" onchange="enableInput(this.id)" th:id="${datatype.datatype}+checkbox" th:text="${datatype.datatype}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-group">
                            <label for="language" th:text="#{create.dataset.languages}"></label>
                            <select multiple="" class="form-control" id="language">
                                <option value="" th:text="#{create.dataset.nooptionselected}">
                                <option th:each="language : ${languages}" th:attr="value = ${language.language}" th:text="${language.description}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-3">
                        <p for="language" th:text="#{create.dataset.daterange}"></p>
                        <div class="form-group right">                            
                            <label for="date1" th:text="#{create.dataset.from}"></label>&nbsp;
                            <input type="date" id="date1" name="date1"><br/>
                            <label for="date2" th:text="#{create.dataset.to}"></label>&nbsp;&nbsp;
                            <input type="date" id="date2" name="date2">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <i class="fas fa-info"></i>&nbsp;<small th:text="#{create.dataset.filteroptions}"></small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 right">
                        <input type="button" onclick="updateDatasetsList()" class="btn btn-primary" th:attr="value = #{create.dataset.apply}">
                    </div>
                </div>
                <div class="row"><div class="col-12">&nbsp;&nbsp;</div></div>
                <div class="row">
                    <div class="col-12">
                        <h4 class="create" th:text="#{create.dataset.select}"></h4> 
                    </div>
                </div>
                <div class="tab-pane fade active show">
                    <div class="alert alert-light" th:if="${datasets.size()==0}" th:text="#{list.datasets.table.nodatasets}"></div>
                    <table class="table table-hover" th:fragment="datasets-list" id="datasets-list">
                        <tr class="alert alert-light" th:if="${datasets.size()==0}"><td colspan="6" th:text="#{list.datasets.table.nodatasets}"></td></tr>
                        <thead th:if="${datasets.size()!=0}">
                        <th scope="col" th:text="#{create.dataset.table.name}"></th>
                        <th scope="col" th:text="#{create.dataset.table.author}"></th>
                        <th scope="col" th:text="#{create.dataset.table.license}"></th>
                        <th scope="col" th:text="#{create.dataset.table.languages}"></th>
                        <th scope="col" th:text="#{create.dataset.table.datatypes}"></th>
                        <th scope="col" th:text="#{create.dataset.table.select}"></th>
                        </thead>
                        <tbody th:if="${datasets.size()!=0}">                            
                            <tr th:each="dataset : ${datasets}">
                                <th scope="row" th:text="${dataset.name}"></th>
                                <td th:text="${dataset.author}"></td>
                                <td th:text="${dataset.license.name}"></td>
                                <td>
                                    <a class="btn btn-list dropdown-toggle" data-toggle="dropdown" href="#">
                                        <i class="fas fa-language"></i>
                                        <span class="icon-caret-down"></span>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li th:text="${language.description}" th:each="language : ${dataset.language}"></li>
                                    </ul>
                                </td>
                                <td>
                                    <a class="btn btn-list dropdown-toggle" data-toggle="dropdown"
                                       href="#">
                                        <i class="fas fa-file-signature"></i>
                                        <span class="icon-caret-down"></span>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li th:text="${datatype.datatype}" th:each="datatype : ${dataset.datatypes}"></li>
                                    </ul>
                                </td>
                                <td><input id="checkboxUpdateTable" class="form-control" type="checkbox" name="datasets" th:attr="value = ${dataset.name}" onclick="updateTable(this.id)"></td>
                            </tr>             
                        </tbody>
                    </table>
                </div>
                <!-- DATASETS LIST -->
                <div id="bs-docs-section">
                    <div class="row"><div class="col-12">&nbsp;&nbsp;</div></div>
                    <div class="row">
                        <div class="col-12">
                            <div id="bs-component">
                                <fieldset>
                                    <legend><h4 class="create" th:text="#{create.dataset.metadata}"></h4></legend>
                                    <div class="form-group">
                                        <label for="#{create.dataset.placeholder.name}" id="lname" name="lname" class="col-md-3 control-label" th:text="#{create.dataset.placeholder.name}" ></label>                                                                    
                                        <input type="text" class="form-control col-md-6" name="name" th:attr="placeholder = #{create.dataset.placeholder.name}" required="required" onchange="dynamicUrl(this.value)" th:value="${dataset.name}">
                                        <label class="error-label" th:if="${#fields.hasErrors('name')}" th:errors="*{name}" th:attr="placeholder = #{add.dataset.placeholder.nameerror}" ></label>
                                    </div>
                                    <div class="form-group">
                                        <label for="#{create.dataset.placeholder.description}" id="ldescription" name="ldescription" class="col-md-12 control-label left" th:text="#{create.dataset.placeholder.description}" ></label>  
                                        <textarea rows="5" class="form-control" name="description" th:attr="placeholder = #{create.dataset.placeholder.description}" required="required" th:text="${dataset.description}"></textarea>
                                        <label class="error-label" th:if="${#fields.hasErrors('description')}" th:errors="*{description}" th:attr="placeholder = #{add.dataset.placeholder.descriptionerror}"></label>
                                    </div>
                                    <div class="form-group">
                                        <label for="DOI" id="ldoi" name="ldoi" class="col-md-12 control-label left" th:text="DOI" ></label>  
                                        <input type="text" class="form-control" name="doi" placeholder="DOI" th:value="${dataset.doi}">
                                        <label class="error-label" th:if="${#fields.hasErrors('doi')}" th:errors="*{doi}" th:attr="placeholder = #{add.dataset.placeholder.doierror}"></label>
                                    </div>
                                    <div class="form-group">
                                        <label th:text="#{create.dataset.label.visibility}" class="col-md-12 control-label left" ></label>&nbsp;&nbsp;
                                        <label class="radio-inline main-text"><input type="radio" name="access" th:value="${T(org.strep.domain.Dataset).ACCESS_PRIVATE}" required="required" checked th:text="#{add.dataset.private}" th:checked="${dataset.access}==null or ${dataset.access}=='private'"></label>&nbsp;
                                        <label class="radio-inline main-text"><input type="radio" name="access" th:value="${T(org.strep.domain.Dataset).ACCESS_PROTECTED}" required="required" th:text="#{add.dataset.protected}" th:checked="${dataset.access}!=null and ${dataset.access}=='protected'"></label>&nbsp;
                                        <label class="radio-inline main-text"><input type="radio" name="access" th:value="${T(org.strep.domain.Dataset).ACCESS_PUBLIC}" required="required" th:text="#{add.dataset.public}" th:checked="${dataset.access}!=null and ${dataset.access}=='public'"></label>&nbsp;
                                    </div>
                                    <div class="form-group">
                                        <label for="#{add.dataset.license}" id="llicense" name="llicense" class="col-md-12 control-label left" th:text="#{add.dataset.license}" ></label>
                                        <select class="form-control col-md-6" id="selectLicense" name="license" required>
                                            <option value="" disabled selected th:text="#{add.dataset.placeholder.license}"></option>
                                            <option th:value="${license.name}" th:text="${license.name}" th:each="license : ${licenses}" th:selected="${dataset.license}!=null and ${dataset.license.name}==${license.name}"></option>
                                        </select>
                                        <label class="error-label" th:if="${#fields.hasErrors('license')}" th:errors="*{license}" th:attr="placeholder = #{add.dataset.placeholder.licenseerror}"></label>
                                    </div>
                                    <div class="form-group">
                                        <label th:text="#{create.dataset.label.url}"></label>
                                        <input type="text" class="form-control col-md-6" id="url" name="url" th:attr="value = ${host}" readonly="readonly">
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                    <div class="row"><div class="col-12">&nbsp;&nbsp;</div></div>
                    <div class="row">
                        <div class="col-12">
                            <fieldset>
                                <legend>
                                    <h4 class="create" th:text="#{create.dataset.parameters}"></h4>
                                </legend>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-2">
                                            <label class="main-text" th:text="#{create.dataset.filenumber}"></label>
                                        </div>
                                        <div class="col-10">
                                            <input type="number" class="form-control col-md-1" id="fileNumber" name="inputFileNumber" value="0" required >
                                        </div>
                                    </div>
                                    <div class="row"><div class="col-12"><label class="text-secondary" th:text="#{create.dataset.parameterscomment}"></label></div></div>
                                    <!-- PARAMETER: SPAM PERCENTAGE -->
                                    <div class="row">
                                        <div class="col-2">
                                            <input type="radio" name="mode" value="spam" checked onclick="checkSelectedDatasets()">
                                            <label th:text="#{create.dataset.spampercentage}"></label>
                                        </div>
                                        <div class="col-10"></div>
                                    </div>
                                    <div class="row" id="spampercentage">
                                        <div class="col-2">
                                            <input type="number" class="form-control col-md-12" id="inputSpamPercentage" name="inputSpamPercentage" value="0" required />
                                        </div>
                                        <div class="col-2">
                                            <input type="button" class="form-control btn btn-primary" name="checkSpamButton" th:attr="value = #{create.dataset.button.check}" onclick="checkIfPosibleSpam()">
                                        </div>
                                        <div class="col-8">
                                            <div th:fragment="info-spam" id="info-spam">
                                                <span class="alert alert-danger" th:text="${spamErrorInput}" th:if="${spamErrorInput}!=null"/>
                                                <span class="alert alert-info" th:text="${spamSuccessInfo}" th:if="${spamSuccessInfo}!=null"/>
                                                <span class="alert alert-danger" th:text="${spamInsufficientInfo}" th:if="${spamInsufficientInfo}!=null"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row"><div class="col-12">&nbsp;</div></div>
                                    <!-- PARAMETER: DATATYPE PERCENTAGE -->
                                    <div class="row">
                                        <div class="col-12">
                                            <input type="radio" name="mode" value="datatype" onclick="checkSelectedDatasets()">
                                            <label th:text="#{create.dataset.datatypespercentage}"></label>
                                            <span class="alert alert-dismissible alert-danger" id="datasetSelectedError" th:text="#{create.dataset.selectdataset}"/>
                                        </div>
                                    </div> 
                                    <div class="row" id="datatypespercentage">
                                        <div class="col-12">
                                            <div th:fragment="datatypes-table" id="datatypes-table">
                                                <div th:each="datatype : ${tableDatatypes}">
                                                    <div class="row">
                                                        <div class="col-1">
                                                            <i class="fas fa-caret-right" ></i>
                                                            <label class="main-text bold" style="line-height: 32px;" th:text="${datatype}"></label>
                                                        </div>
                                                        <div class="col-3">
                                                            <label>% Spam</label>&nbsp;
                                                            <input th:if="${__${'inputspam'+ #strings.replace(datatype,'.','')}__}!=null" type="number" th:id="'inputSpam'+${datatype}" th:name="'inputSpam'+${datatype}" th:attr="value = ${__${'inputspam'+ #strings.replace(datatype,'.','')}__}" required >
                                                            <input th:unless="${__${'inputspam'+ #strings.replace(datatype,'.','')}__}!=null" type="number" th:id="'inputSpam'+${datatype}" th:name="'inputSpam'+${datatype}" value="0" required >
                                                            <span th:class="${class}" th:if="${__${'necesary'+ #strings.replace(datatype,'.','') + 'spam'}__}!=null" th:text="'Necesary: ' + ${__${'necesary'+ #strings.replace(datatype,'.','')+'spam'}__}"></span>&nbsp;
                                                            <span th:class="${class}" th:if="${__${'available'+ #strings.replace(datatype,'.','')+'spam'}__}!=null" th:text="'Available: ' + ${__${'available'+ #strings.replace(datatype,'.','')+'spam'}__}"></span>
                                                        </div>
                                                        <div class="col-3">
                                                            <label>% Ham</label>&nbsp;
                                                            <input th:if="${__${'inputham'+ #strings.replace(datatype,'.','')}__}!=null" type="number" th:id="'inputHam'+${datatype}" th:name="'inputHam'+${datatype}" th:attr="value = ${__${'inputham'+ #strings.replace(datatype,'.','')}__}" required>
                                                            <input th:unless="${__${'inputham'+ #strings.replace(datatype,'.','')}__}!=null" type="number" th:id="'inputHam'+${datatype}" th:name="'inputHam'+${datatype}" value="0" required>
                                                            <span  th:class="${class}" th:if="${__${'necesary'+ #strings.replace(datatype,'.','') + 'ham'}__}!=null" th:text="'Necesary: ' + ${__${'necesary'+ #strings.replace(datatype,'.','')+'ham'}__}"></span>&nbsp;
                                                            <span  th:class="${class}" th:if="${__${'available'+ #strings.replace(datatype,'.','')+'ham'}__}!=null" th:text="'Available: ' + ${__${'available'+ #strings.replace(datatype,'.','')+'ham'}__}"></span>
                                                        </div>
                                                        <div class="col-5"></div>
                                                    </div>
                                                </div>
                                                <div class="row" th:if="${tableDatatypes!=null}">
                                                    <div class="col-7 right padding">
                                                        <input id="buttonCheckDatatypes" type="button" class="btn btn-primary col-md-3" onclick="updateTable(this.id)" th:attr="value = #{create.dataset.button.check}">
                                                    </div>
                                                    <div class="col-5"></div>
                                                </div>
                                                <div class="row" th:if="${datatypesInputError}">
                                                    <div class="col-12 alert alert-dismissible alert-danger">
                                                        <i class="fas fa-exclamation-triangle"></i>&nbsp;
                                                        <span  class="error-label" th:text="${datatypesInputError}"></span>
                                                    </div>
                                                </div>
                                                <div class="row" th:unless="${datatypesInputError!=''}">
                                                    <div class="col-12 alert alert-dismissible alert-info">
                                                        <span th:if="${datatypesSuccessInfo}" class="info-label" th:utext="${datatypesSuccessInfo}"></span>
                                                        <span th:if="${datatypesInsufficientInfo}" class="error-label" th:utext="${datatypesInsufficientInfo}"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <hr/>
                    <div class="row">
                        <div class="col-12 right">
                            <input type="submit" class="btn btn-primary" th:attr="value = #{create.dataset.button.submit}"><br>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div th:include="footer"></div>
    </body>
</html>
